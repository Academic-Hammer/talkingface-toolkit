## 服务器端

#### Windows服务器端：

1.下载[Carla0.9.12预编译版本](https://github.com/carla-simulator/carla/releases/tag/0.9.12)（不需要下载额外地图包）

2.解压使用

#### Linux服务器端：

1.安装18.04或20.04版本Ubuntu物理机（虚拟机无法识别GPU显卡），[参考](https://huaweicloud.csdn.net/63560e7ad3efff3090b591d1.html)

2.禁用Ubuntu内核升级，[参考](https://blog.csdn.net/maohule/article/details/107370788)

3.安装显卡驱动，[参考方式二](https://blog.csdn.net/zataji/article/details/123104569)

4.下载[Carla0.9.12预编译版本](https://github.com/carla-simulator/carla/releases/tag/0.9.12)

5.解压使用

## 远程客户端

[参考来源]: https://github.com/mjxu96/carlaviz	"Carlaviz"

> 建议使用Ubuntu20.04系统虚拟机安装

#### 安装依赖库：

1.安装依赖库

```python
sudo apt-get update
sudo apt-get install build-essential g++-7 clang-7 cmake libpng-dev libtiff5-dev libjpeg-dev tzdata sed curl wget unzip autoconf libtool
```

2.下载Carla客户端库并安装，[下载地址](https://pypi.org/project/carla/0.9.12/#files)

```python
python3 -V && pip3 -V #查看本机python3及pip版本
pip3 install --upgrade pip #更新pip到最新版本 (version >=20.3) 
pip3 install carla-0.9.12*.whl #下载对应的系统及python版本的安装包，使用pip安装
```

> 以下三个库为客户端前端依赖

3.安装Protobuf C++版本（version >=3.11.0 <=3.11.4），[下载地址](https://github.com/protocolbuffers/protobuf/releases/tag/v3.11.0)

```python
#protobuf根目录下
mkdir build 
cd build
cmake .. --parallel 10
make
sudo make install
```

4.安装nodejs 12.x

```python
curl -sL https://deb.nodesource.com/setup_12.x | sudo -E bash -
sudo apt-get install -y nodejs
```

5.安装yarn

```python
curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
sudo apt-get update && sudo apt-get install -y yarn
```

#### 安装源码及修改：

````python
git clone --recurse-submodules https://github.com/wx9698/carlaviz.git
cd carlaviz
git checkout 0.9.12
./setup/setup.sh #等待编译完成，无报错进行下一步
'''
到这一步后需要修改客户端后端源码中的host为服务器IP才能实现远程连接，具体修改如下：
'''
1. cd carlaviz/backend && rm build/* rm bin/* #删除后端已经编译好的代码文件
2. vim include/backend/proxy/carla_proxy.h #第138行 localhost替换成服务器端IP
3. vim include/backend.backend.h #同样将localhost替换成服务器端IP
4. cd build && cmake .. && make backend -j8 #编译完成，进行远程连接
````

## 建立远程连接

> 一共需要开启四个终端窗口，服务器一个，客户端三个

```python
1. #启动服务器
./CarlaUE4.sh

2. #客户端启用后端连接服务器
./backend/bin/backend

3. #客户端启用前端打开网页
cd frontend
yarn start
#打开浏览器输入如下网址及端口
localhost:8080 

4. #打开终端，输入控制命令
cd examples
python3 example.py
```

